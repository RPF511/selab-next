import Link from 'next/link'
import theme from '../components/theme'
import React, { useState, useRef, useEffect, forwardRef, useLayoutEffect } from 'react'
import { useScrollPosition } from '@n8tb1t/use-scroll-position'

const TestElement = ({ title, content, backgroundColor, callback }) => {

    const elementRef = useRef()
    useScrollPosition(({ currPos }) => {

        if (currPos.y <= 85 && currPos.y >= 0) {
            console.log(title)
            callback(backgroundColor, currPos.y / 85 * 100)
        }

    }, [], elementRef)

    return (

        <div className="asdfsafd" ref={elementRef} style={{ ...styles.element, backgroundColor, }}>

            <p style={{ flex: 1 }}>{title}</p>
            <p style={{ flex: 1 }}>{content}</p>
        </div>


    )
}

const Index = (props) => {
    const { texts } = props
    const [backgroundState, setBackgroundState] = useState({
        lastColor: theme.COLORS.BG1,
        currentColor: theme.COLORS.BG1,
        amount: "100%",
    })
    



    const changeBackgroundColor = (bgcolor, amount) => {
        console.log(`${bgcolor}, ${amount}`)
        const {currentColor, lastColor} = backgroundState
        setBackgroundState({
            lastColor: currentColor,
            currentColor: bgcolor,
            amount,
        })
    }

    


    const {currentColor, lastColor, amount} = backgroundState
    const background = `linear-gradient(${lastColor} ${amount}%,${lastColor} 0%,${currentColor} 0%, ${currentColor} ${100 - amount}%)`

    return (
        <div style={styles.container}>
            <Header background={background} />
            {texts.map((text, index) => <TestElement key={index} {...text} callback={changeBackgroundColor} />)}
            <style global jsx>{`
            body {
                margin: 0;
                padding: 0;
            }
            `}</style>
        </div>
    )
}
const Header = ({ background }) => {
    return (
        <header style={{ ...styles.header, background }}>
            <h1>SELab</h1>
            <p>{`This is SELAB's main page`}</p>
        </header>
    )
}

const styles = {
    container: {
        flex: 1,
        backgroundColor: theme.COLORS.BG1,
        ...theme.FONTS,
        color: "white",
    },
    element: {
        flex: 1,
        height: '30vh',
        backgroundColor: 'white',
        color: 'black',
        textAlign: "center",
        paddingTop: '10vh',
    },
    header: {
        position: '-webkit-sticky',
        position: 'sticky',
        top: 0,
        width: "100%",
        background: 'linear-gradient( #FFC0CB 50%, #00FFFF 50%)',
        margin: 0,

    }
}

Index.getInitialProps = async ({ req }) => {
    const userAgent = req ? req.headers['user-agent'] : navigator.userAgent
    console.log(userAgent)
    const texts = [
        { title: "This is Test1", content: "Hello World!", backgroundColor: theme.COLORS.BG1 },
        { title: "This is Test2", content: "Hello World!", backgroundColor: theme.COLORS.BG2 },
        { title: "This is Test3", content: "Hello World!", backgroundColor: theme.COLORS.BG1 },
        { title: "This is Test4", content: "Hello World!", backgroundColor: theme.COLORS.BG2 },
        { title: "This is Test5", content: "Hello World!", backgroundColor: theme.COLORS.BG1 },
        { title: "This is Test1", content: "Hello World!", backgroundColor: theme.COLORS.BG1 },
        { title: "This is Test2", content: "Hello World!", backgroundColor: theme.COLORS.BG2 },
        { title: "This is Test3", content: "Hello World!", backgroundColor: theme.COLORS.BG1 },
        { title: "This is Test4", content: "Hello World!", backgroundColor: theme.COLORS.BG2 },
        { title: "This is Test5", content: "Hello World!", backgroundColor: theme.COLORS.BG1 },
    ]
    return { texts }
}

export default Index